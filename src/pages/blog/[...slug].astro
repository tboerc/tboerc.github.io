---
import { getCollection, getEntry } from 'astro:content'
import { getLocale } from 'astro-i18n-aut'
import BlogPostLayout from '@layouts/BlogPostLayout.astro'
import { DEFAULT_LOCALE } from '@i18n/index'

export async function getStaticPaths() {
	const blogEntries = await getCollection('blog', (entry) => entry.slug.startsWith(DEFAULT_LOCALE + '/'))
	return blogEntries.map((entry) => ({
		params: { slug: entry.slug.replace(`${DEFAULT_LOCALE}/`, '') }
	}))
}

const locale = getLocale(Astro.url) ?? DEFAULT_LOCALE
const { slug } = Astro.params

const entry = await getEntry({
	collection: 'blog',
	slug: locale + '/' + slug
})

if (!entry) {
	return new Response(null, { status: 404, statusText: 'Not found' })
}

const { Content } = await entry.render()
---

<BlogPostLayout {...entry.data} body={entry.body}>
	<Content />
</BlogPostLayout>
